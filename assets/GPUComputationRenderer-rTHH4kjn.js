import{m as V,v as _,B as I,aX as b,ac as h,o as D,W as M,F as w,R,y as U,s as F}from"./extends-C6mqsnfH.js";const A=new _(-1,1,1,-1,0,1);class C extends I{constructor(){super(),this.setAttribute("position",new b([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new b([0,2,0,0,2,0],2))}}const G=new C;class B{constructor(s){this._mesh=new V(G,s)}dispose(){this._mesh.geometry.dispose()}render(s){s.render(this._mesh,A)}get material(){return this._mesh.material}set material(s){this._mesh.material=s}}class W{constructor(s,l,u){this.variables=[],this.currentTextureIndex=0;let g=w;const T={passThruTexture:{value:null}},m=x(y(),T),c=new B(m);this.setDataType=function(t){return g=t,this},this.addVariable=function(t,e,a){const n=this.createShaderMaterial(e),r={name:t,initialValueTexture:a,material:n,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:h,magFilter:h};return this.variables.push(r),r},this.setVariableDependencies=function(t,e){t.dependencies=e},this.init=function(){if(u.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let t=0;t<this.variables.length;t++){const e=this.variables[t];e.renderTargets[0]=this.createRenderTarget(s,l,e.wrapS,e.wrapT,e.minFilter,e.magFilter),e.renderTargets[1]=this.createRenderTarget(s,l,e.wrapS,e.wrapT,e.minFilter,e.magFilter),this.renderTexture(e.initialValueTexture,e.renderTargets[0]),this.renderTexture(e.initialValueTexture,e.renderTargets[1]);const a=e.material,n=a.uniforms;if(e.dependencies!==null)for(let r=0;r<e.dependencies.length;r++){const i=e.dependencies[r];if(i.name!==e.name){let o=!1;for(let d=0;d<this.variables.length;d++)if(i.name===this.variables[d].name){o=!0;break}if(!o)return"Variable dependency not found. Variable="+e.name+", dependency="+i.name}n[i.name]={value:null},a.fragmentShader=`
uniform sampler2D `+i.name+`;
`+a.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){const t=this.currentTextureIndex,e=this.currentTextureIndex===0?1:0;for(let a=0,n=this.variables.length;a<n;a++){const r=this.variables[a];if(r.dependencies!==null){const i=r.material.uniforms;for(let o=0,d=r.dependencies.length;o<d;o++){const v=r.dependencies[o];i[v.name].value=v.renderTargets[t].texture}}this.doRenderTarget(r.material,r.renderTargets[e])}this.currentTextureIndex=e},this.getCurrentRenderTarget=function(t){return t.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(t){return t.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){c.dispose();const t=this.variables;for(let e=0;e<t.length;e++){const a=t[e];a.initialValueTexture&&a.initialValueTexture.dispose();const n=a.renderTargets;for(let r=0;r<n.length;r++)n[r].dispose()}};function f(t){t.defines.resolution="vec2( "+s.toFixed(1)+", "+l.toFixed(1)+" )"}this.addResolutionDefine=f;function x(t,e){e=e||{};const a=new D({name:"GPUComputationShader",uniforms:e,vertexShader:S(),fragmentShader:t});return f(a),a}this.createShaderMaterial=x,this.createRenderTarget=function(t,e,a,n,r,i){return t=t||s,e=e||l,a=a||F,n=n||F,r=r||h,i=i||h,new M(t,e,{wrapS:a,wrapT:n,minFilter:r,magFilter:i,format:R,type:g,depthBuffer:!1})},this.createTexture=function(){const t=new Float32Array(s*l*4),e=new U(t,s,l,R,w);return e.needsUpdate=!0,e},this.renderTexture=function(t,e){T.passThruTexture.value=t,this.doRenderTarget(m,e),T.passThruTexture.value=null},this.doRenderTarget=function(t,e){const a=u.getRenderTarget(),n=u.xr.enabled,r=u.shadowMap.autoUpdate;u.xr.enabled=!1,u.shadowMap.autoUpdate=!1,c.material=t,u.setRenderTarget(e),c.render(u),c.material=m,u.xr.enabled=n,u.shadowMap.autoUpdate=r,u.setRenderTarget(a)};function S(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function y(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}}export{W as G};
