function W(o,b=1e-4){b=Math.max(b,Number.EPSILON);const S={},f=o.getIndex(),j=o.getAttribute("position"),k=f?f.count:j.count;let c=0;const l=Object.keys(o.attributes),A={},r={},w=[],x=["getX","getY","getZ","getW"],N=["setX","setY","setZ","setW"];for(let n=0,i=l.length;n<i;n++){const e=l[n],t=o.attributes[e];A[e]=new t.constructor(new t.array.constructor(t.count*t.itemSize),t.itemSize,t.normalized);const h=o.morphAttributes[e];h&&(r[e]||(r[e]=[]),h.forEach((s,u)=>{const a=new s.array.constructor(s.count*s.itemSize);r[e][u]=new s.constructor(a,s.itemSize,s.normalized)}))}const X=b*.5,v=Math.log10(1/b),g=Math.pow(10,v),E=X*g;for(let n=0;n<k;n++){const i=f?f.getX(n):n;let e="";for(let t=0,h=l.length;t<h;t++){const s=l[t],u=o.getAttribute(s),a=u.itemSize;for(let m=0;m<a;m++)e+=`${~~(u[x[m]](i)*g+E)},`}if(e in S)w.push(S[e]);else{for(let t=0,h=l.length;t<h;t++){const s=l[t],u=o.getAttribute(s),a=o.morphAttributes[s],m=u.itemSize,F=A[s],O=r[s];for(let p=0;p<m;p++){const M=x[p],I=N[p];if(F[I](c,u[M](i)),a)for(let d=0,T=a.length;d<T;d++)O[d][I](c,a[d][M](i))}}S[e]=c,w.push(c),c++}}const z=o.clone();for(const n in o.attributes){const i=A[n];if(z.setAttribute(n,new i.constructor(i.array.slice(0,c*i.itemSize),i.itemSize,i.normalized)),n in r)for(let e=0;e<r[n].length;e++){const t=r[n][e];z.morphAttributes[n][e]=new t.constructor(t.array.slice(0,c*t.itemSize),t.itemSize,t.normalized)}}return z.setIndex(w),z}export{W as m};
